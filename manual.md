---
layout: default
---

# 利用マニュアル

セットアップ手順
----------------
#### 1. Python のバージョン確認
ターミナル上で以下のコマンドを実行します。  
```python --version```

このようにバージョンが表示されることと、バージョンが 2.6.0 以上であることを確認します。    
```Python 2.7.2```

#### 2. モジュールの配備
このページの右上にある「tar.gz」または「.zip」ボタンからファイル一式をダウンロードします。

  * 過去のバージョンは [こちら](https://github.com/mogproject/easy-menu/tags) からダウンロードできます。

ファイルを解凍し、```easy_menu.py```と```config.json```(サンプル用の設定ファイル) を対象サーバの任意の場所 (同じディレクトリ配下) にコピーします。

実行ユーザに対して、以下のアクセス権限を適切に設定します。

  * ```easy_menu.py```に対する実行権限
  * ディレクトリに対する書き込み権限 (ログファイルを作成するため)

#### 3. 起動確認
ターミナル上でモジュールを配備したディレクトリへ移動し、以下のコマンドを実行します。  

    easy_menu.py

**Easy Menu** の画面が表示されたら、操作をしてみてください。

  * 実行されるコマンドは全て```echo```コマンドなので、ご自由にお試しいただけます。
  * 実行後、同じ場所に出力されたログファイル```easy_menu.log```をご確認ください。

#### 4. 設定ファイルのカスタマイズ
要件に応じて設定ファイル```config.json```をカスタマイズします。  

  *  後述の **設定ファイル 作成ガイド** をご参照ください。
  * 日本語を使用する場合、設定ファイルの文字コードは **UTF-8** のみサポートされます。

ファイル構成
------------
ファイル名      |概要                                        | 必要なアクセス権限
----------------|--------------------------------------------|-------------------
easy_menu.py    | 実行ファイル本体                           | 実行
config.json     | デフォルトの設定ファイル                   | 読み取り
easy_menu.log   | デフォルトのログファイル                   | 書き込み
easy_menu.log.1 | 一世代前のログファイル<br/>(1MB単位で洗い替え) | 書き込み

  * ログファイルはファイルサイズに応じて自動的に洗い替えが行われます。
  
使用方法
--------
    easy_menu.py [オプション]

    オプション:
      --version             バージョン情報の表示
      -h, --help            ヘルプメッセージの表示
      -c 設定ファイルのパス, --config=設定ファイルのパス
                            デフォルトは config.json
      -l ログファイルのパス, --log=ログファイルのパス
                            デフォルトは easy_menu.log
      -e エンコード, --encode=エンコード
                            デフォルトはシステムの既定値 


設定ファイル 作成ガイド
-----------------------
#### 概要
  * 設定ファイルは、JSON(JavaScript Object Notation/RFC 4627)に準拠して記述します。
  * 1個のメニューは、「name」「item」という2種類のキーを持つオブジェクトとして表現します。(以下、メニューオブジェクトとします)
  * 設定ファイルは、その全体が 1個のメニューオブジェクトでなければなりません。  
    それがツール起動時に表示されるメニューとなります。

##### メニューオブジェクト
キー | 値の型  | 概要
-----|---------|------
name | 文字列  | メニューのタイトル
item | 配列    | メニューの内容  

item は以下のような配列として記述します。

```項目名, <コマンドライン|メニューオブジェクト> [, 項目名, <コマンドライン|メニューオブジェクト> ...]```

  * 項目名、コマンドラインは文字列です。
  * 配列の1番目と2番目、3番目と4番目というように2個の要素を組にして1個のメニュー項目を表現します。
  * 偶数番目の要素にメニューオブジェクトを記述した場合、その項目を選択するとサブメニューへの遷移が行われます。
  * item の要素数は偶数でなければなりません。
  * メニュー項目は 1～16個の範囲でなければなりません。これ以上必要な場合はサブメニューを作成し構造を階層化してください。

#### 記述例
##### メインメニューの作成
メインメニューに、以下の 4個のコマンドを登録する場合の例を示します。

項目名    | コマンドライン
----------|----------------------------
コマンド1 | /usr/bin/local/command1.sh
コマンド2 | /usr/bin/local/command2.sh
コマンド3 | /usr/bin/local/command3.sh
コマンド4 | /usr/bin/local/command4.sh

まず、ファイル全体を波かっこでくくります。  

```
{
}
```
  * メニューオブジェクトのキーと値を仮置きします。
    * 文字列は全てダブルクォーテーションで囲む必要があります。
    * キーと値の組の間はカンマで区切ります。
    * item は配列なので角かっこで囲んでください。

```
{
  "name": "",
  "item": []
}
```

メニューの名前を記述します。ここでは「メインメニュー」とします。

```
{
  "name": "メインメニュー",
  "item": []
}
```

メニュー項目を配列で定義します。以下のように、項目名とコマンドラインを交互に記述します。

  * 配列の終端にカンマを付けるとJSONフォーマットエラーとなってしまうのでご注意ください。

```
{
  "name": "メインメニュー",
  "item": [
    "コマンド1", "/usr/bin/local/command1.sh",
    "コマンド2", "/usr/bin/local/command2.sh",
    "コマンド3", "/usr/bin/local/command3.sh",
    "コマンド4", "/usr/bin/local/command4.sh"
  ]
}
```
これで完成です。

##### サブメニューの作成

先ほどの定義ファイルに、サブメニューを追加してみましょう。  
サブメニューには以下のコマンドを定義します。

項目名    | コマンドライン
----------|----------------------------
コマンド5 | /usr/bin/local/command5.sh
コマンド6 | /usr/bin/local/command6.sh

まず、サブメニューへ遷移するための項目を追加します。  
偶数番目の要素には、文字列ではなくオブジェクト(波かっこ)を定義します。

```
{
  "name": "メインメニュー",
  "item": [
    "コマンド1", "/usr/bin/local/command1.sh",
    "コマンド2", "/usr/bin/local/command2.sh",
    "コマンド3", "/usr/bin/local/command3.sh",
    "コマンド4", "/usr/bin/local/command4.sh",
    "サブメニューへ", {}
  ]
}
```

追加したオブジェクトは、やはりメニューとなりますので  
メニューオブジェクトに必要な「name」と「item」を追加します。

```
{
  "name": "メインメニュー",
  "item": [
    "コマンド1", "/usr/bin/local/command1.sh",
    "コマンド2", "/usr/bin/local/command2.sh",
    "コマンド3", "/usr/bin/local/command3.sh",
    "コマンド4", "/usr/bin/local/command4.sh",
    "サブメニューへ", {
      "name": "",
      "item": []
    }
  ]
}
```

あとはメインメニューを作った時と同じです。  
メニューの名前、メニュー項目を記述します。

```
{
  "name": "メインメニュー",
  "item": [
    "コマンド1", "/usr/bin/local/command1.sh",
    "コマンド2", "/usr/bin/local/command2.sh",
    "コマンド3", "/usr/bin/local/command3.sh",
    "コマンド4", "/usr/bin/local/command4.sh",
    "サブメニューへ", {
      "name": "サブメニュー",
      "item": [
        "コマンド5", "/usr/bin/local/command5.sh",
        "コマンド6", "/usr/bin/local/command6.sh"
      ]
    }
  ]
}
```

これで階層化したメニューを作ることができました。  
この要領で、さらに深い階層のサブメニューを作ることも可能です。

サンプルの [config.json](https://github.com/mogproject/easy-menu/blob/master/config.json) を参考にしてみてください。

さらなる活用方法
----------------

#### 専用ユーザを設定する (Linux / UNIX / MacOS)
専用のOSユーザを作成し、ターミナル接続時の **Easy Menu** 以外の操作を制限すれば、より安全な運用ができるようになります。

  * 実現方法の一つは、ログインシェルの rc ファイル(bash であれば ```.bashrc```)を  
    編集することです。   
    rc ファイルの末尾に以下のような記述をすれば、そのユーザは **Easy Menu** を実行  
    することしかできません。  
    (ユーザのホームディレクトリに **Easy Menu** を配備した場合の例)  

```
# Launch Easy Menu
~/easy_menu.py
exit
```

  * 詳細は各OSまたはシェルのマニュアルをご参照ください。
  * ログインシェル自体を変更しても同様の挙動となりますが、環境によって文字コードの認識が正しく行われない場合があります。

#### コマンドを別ユーザの権限で実行する (Linux / UNIX / MacOS)
  * コマンドを別ユーザの権限で実行する必要がある場合は、```sudo```コマンドを利用すると便利です。  
    **Easy Menu** の設定ファイルには以下のように記述してください。
    * root ユーザの権限で実行する場合: ```"sudo コマンド名"```
    * 他ユーザの権限で実行する場合: ```"sudo -u ユーザ名 コマンド名"```
  * 詳細は各OSのマニュアルをご参照ください。
    * 一般的には ```sudo``` コマンドをインストールした上で、```visudo``` コマンドによる  
      権限設定が必要です。

